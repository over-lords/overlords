<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
    <link href='https://fonts.googleapis.com/css?family=Racing Sans One' rel='stylesheet'>
    <link rel="icon" href="https://raw.githubusercontent.com/over-lords/overlords/4c614c1ffe5a9d7194202bd24fae5e7c99d86333/Public/Images/Site%20Assets/favicon.png" type="image/png">
    <link rel="stylesheet" href="style.css">
    <title>Overlords</title>
</head>
<body style="background-color:white;" onload="window.scrollTo(0, 1)">
    <div class="bg-image" alt="" style="opaCity: 35%;"></div>
    <div class="container">
        <div class="title-box" id="title-box"></div>
        <h1 class="glow-red" style="pointer-events: none;">Overlords</h1>

        <div class="back-box" id="back-box" onclick="location.href='index.html'" style="cursor: pointer; margin-top: -30px; height: 30px; background-color: #5d5d5d; border: 5px solid #000;">
            <h1 class="menu-text" style="font-size: 1.8rem; margin-top: 0px; pointer-events: none;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Return to Home</h1>
        </div>

        <!-- LIST RESULTS RETURNED HERE -->

    </div>

    <script type="module">
        import { heroes } from './data/faceCards.js';

        // --- Decrypt Function ---
        async function decryptData(cipherText, secretKey) {
        const data = atob(cipherText);
        const bytes = new Uint8Array([...data].map(c => c.charCodeAt(0)));
        const iv = bytes.slice(0, 12);
        const cipher = bytes.slice(12);

        // Derive 256-bit key from the secret string
        const keyMaterial = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(secretKey));
        const key = await crypto.subtle.importKey(
            'raw',
            keyMaterial,
            { name: 'AES-GCM' },
            false,
            ['decrypt']
        );

        const decrypted = await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, cipher);
        const decoded = new TextDecoder().decode(decrypted);
        return JSON.parse(decoded);
        }

        // --- Display Heroes ---
        (async () => {
        const params = new URLSearchParams(window.location.search);
        const encrypted = params.get('data');
        const SECRET = 'GeimonHeroKey42';

        if (!encrypted) {
            document.body.insertAdjacentHTML('beforeend', '<p style="color:red;">No loadout data found.</p>');
            return;
        }

        try {
            const selectedHeroes = await decryptData(encrypted, SECRET);

            // Map IDs â†’ hero objects (using imported heroes array)
            const heroMap = new Map(heroes.map(h => [String(h.id), h]));
            const heroList = selectedHeroes.map(id => heroMap.get(String(id)) || { name: `Unknown (ID ${id})` });

            // Create a container for display, moved down 200px
            const container = document.createElement('div');
            container.style.marginTop = '200px';
            container.style.textAlign = 'center';
            container.innerHTML = `
            <h2 style="margin-bottom:10px;">Loaded Heroes (in order selected):</h2>
            <ol style="display:inline-block; text-align:left;">
                ${heroList.map(h => `<li>${h.name}</li>`).join('')}
            </ol>
            `;

            document.querySelector('.container').appendChild(container);
        } catch (e) {
            console.error('Failed to decrypt data:', e);
            document.body.insertAdjacentHTML('beforeend', '<p style="color:red;">Invalid or corrupted data.</p>');
        }
        })();
    </script>
</body>
</html>